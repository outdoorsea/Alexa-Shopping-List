services:
  alexa_api:
    build:
      context: .
      dockerfile: Dockerfile # Use the new Dockerfile at the root
    container_name: alexa_shopping_api
    ports:
      # Map host port 8000 to container port 8000 (or use API_PORT)
      - "${API_PORT:-8000}:8000" # Default to 8000 if API_PORT not set
    volumes:
      # Use a named volume for persistent data (e.g., cookies)
      - cookie_data:/app/data
    env_file:
      # Load environment variables from .env file
      - .env
    # Healthcheck to ensure the application is running
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/"] # Use the root endpoint
      interval: 30s
      timeout: 10s
      retries: 3
    # Optional: Resource limits (uncomment if needed)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1'
    #       memory: 512M
    restart: unless-stopped

# Declare the named volume used by the service
volumes:
  cookie_data:
